"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[33600],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=d(n),h=i,m=u["".concat(l,".").concat(h)]||u[h]||c[h]||o;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:i,r[1]=s;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},38610:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),i=n(44996);const o=e=>a.createElement("div",null,a.createElement("p",{align:"center"},a.createElement("figure",null,a.createElement("img",{style:{width:e.width},alt:e.alt,src:(0,i.Z)(e.source)}),a.createElement("figcaption",{class:"image-caption",style:{fontStyle:"italic",opacity:.6,fontSize:"0.9rem"}},e.caption))))},92908:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),i=n(39960);n(44996);const o=()=>a.createElement("span",{className:"in-blog-cta--divider"}," \u2192 "),r=()=>a.createElement("p",{className:"in-blog-cta-link-container"},a.createElement(i.Z,{className:"in-blog-cta--link",to:"https://e44cy1h4s0q.typeform.com/to/ycUzQa5A"},"We are in Beta (try it out)!"),a.createElement(o,null),a.createElement(i.Z,{className:"in-blog-cta--link",to:"https://discord.gg/rzdnErX"},"Join our community"),a.createElement(o,null),a.createElement(i.Z,{className:"in-blog-cta--link",to:"https://wasp-lang.notion.site/Founding-Engineer-at-Wasp-402274568afa4d7eb7f428f8fa2c0816"},"Work with us"))},73090:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(87462),i=(n(67294),n(3905));n(39960),n(44996),n(92908),n(70589),n(38610);const o={title:"Build Your Own Personal Twitter Agent \ud83e\udde0\ud83d\udc26\u26d3 with LangChain",authors:["vinny"],image:"/img/build-your-own-twitter-agent/twitter-agent-logo.png",tags:["wasp","ai","gpt","langchain","fullstack","node","react","agent"]},r=void 0,s={permalink:"/blog/2023/06/27/build-your-own-twitter-agent-langchain",editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/blog/2023-06-27-build-your-own-twitter-agent-langchain.md",source:"@site/blog/2023-06-27-build-your-own-twitter-agent-langchain.md",title:"Build Your Own Personal Twitter Agent \ud83e\udde0\ud83d\udc26\u26d3 with LangChain",description:"TL;DR",date:"2023-06-27T00:00:00.000Z",formattedDate:"June 27, 2023",tags:[{label:"wasp",permalink:"/blog/tags/wasp"},{label:"ai",permalink:"/blog/tags/ai"},{label:"gpt",permalink:"/blog/tags/gpt"},{label:"langchain",permalink:"/blog/tags/langchain"},{label:"fullstack",permalink:"/blog/tags/fullstack"},{label:"node",permalink:"/blog/tags/node"},{label:"react",permalink:"/blog/tags/react"},{label:"agent",permalink:"/blog/tags/agent"}],readingTime:45.765,hasTruncateMarker:!0,authors:[{name:"Vinny",title:"DevRel @ Wasp",url:"https://vincanger.github.io",email:"vince@wasp-lang.dev",imageURL:"https://vincanger.github.io/assets/vince_smiley.jpg",key:"vinny"}],frontMatter:{title:"Build Your Own Personal Twitter Agent \ud83e\udde0\ud83d\udc26\u26d3 with LangChain",authors:["vinny"],image:"/img/build-your-own-twitter-agent/twitter-agent-logo.png",tags:["wasp","ai","gpt","langchain","fullstack","node","react","agent"]},prevItem:{title:"What can you build with Wasp?",permalink:"/blog/2023/06/28/what-can-you-build-with-wasp"},nextItem:{title:"Wasp Launch Week #3: Magic",permalink:"/blog/2023/06/22/wasp-launch-week-three"}},l={authorsImageUrls:[void 0]},d=[{value:"TL;DR",id:"tldr",level:2},{value:"Before We Begin",id:"before-we-begin",level:2},{value:"Background",id:"background",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Set up your Wasp project",id:"set-up-your-wasp-project",level:3},{value:"Server-Side &amp; Database Entities",id:"server-side--database-entities",level:3},{value:"Database Setup",id:"database-setup",level:3},{value:"Embedding Ideas &amp; Notes",id:"embedding-ideas--notes",level:2},{value:"Server Action",id:"server-action",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Adding Tailwind CSS",id:"adding-tailwind-css",level:3},{value:"Adding Notes Client-side",id:"adding-notes-client-side",level:3},{value:"Generating New Ideas &amp; Tweet Drafts",id:"generating-new-ideas--tweet-drafts",level:2},{value:"Using LangChain&#39;s Sequential Chains",id:"using-langchains-sequential-chains",level:3},{value:"Scraping Twitter",id:"scraping-twitter",level:3},{value:"Server Action",id:"server-action-1",level:3},{value:"Fetching &amp; Displaying Ideas",id:"fetching--displaying-ideas",level:2},{value:"Defining a Server-side Query",id:"defining-a-server-side-query",level:3},{value:"Displaying Ideas Client-side",id:"displaying-ideas-client-side",level:3},{value:"Creating an Account Settings Page",id:"creating-an-account-settings-page",level:3},{value:"Adding a Cron Job",id:"adding-a-cron-job",level:3},{value:"Adding a Notes Page",id:"adding-a-notes-page",level:3},{value:"You Did it! Your own Twitter Intern \ud83e\udd16",id:"you-did-it-your-own-twitter-intern-",level:2}],p={toc:d},u="wrapper";function c(e){let{components:t,...o}=e;return(0,i.kt)(u,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"tldr"},"TL;DR"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://js.langchain.com"},"LangChain"),", ChatGPT, and other emerging technology have made it possible to build some really creative tools. "),(0,i.kt)("p",null,"In this tutorial, we\u2019ll build a full-stack web app that acts as our own personal Twitter Agent, or \u201cintern\u201d, as I like to call it. It keeps track of your notes and ideas, and uses them \u2014 along with tweets from trending-setting twitter users \u2014 to brainstorm new ideas and write tweet drafts for you! \ud83d\udca5"),(0,i.kt)("p",null,"BTW, If you get stuck during the tutorial, or at any point just want to check out the full, final repo of the app we're building, here it is: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vincanger/twitter-intern"},"https://github.com/vincanger/twitter-intern")),(0,i.kt)("h2",{id:"before-we-begin"},"Before We Begin"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://wasp-lang.dev"},"Wasp = }")," is the only open-source, completely serverful fullstack React/Node framework with a built in compiler that lets you build your app in a day and deploy with a single CLI command."),(0,i.kt)("p",null,"We\u2019re working hard to help you build performant web apps as easily as possibly \u2014 including making these tutorials, which are released weekly!"),(0,i.kt)("p",null,"We would be super grateful if you could help us out by starring our repo on GitHub: ",(0,i.kt)("a",{parentName:"p",href:"https://www.github.com/wasp-lang/wasp"},"https://www.github.com/wasp-lang/wasp")," \ud83d\ude4f"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://media2.giphy.com/media/d0Pkp9OMIBdC0/giphy.gif?cid=7941fdc6b39mgj7h8orvi0f4bjebceyx4gj0ih1xb6s05ujc&ep=v1_gifs_search&rid=giphy.gif&ct=g",alt:"https://media2.giphy.com/media/d0Pkp9OMIBdC0/giphy.gif?cid=7941fdc6b39mgj7h8orvi0f4bjebceyx4gj0ih1xb6s05ujc&ep=v1_gifs_search&rid=giphy.gif&ct=g"})),(0,i.kt)("p",null,"\u2026e",(0,i.kt)("em",{parentName:"p"},"ven Ron would star ",(0,i.kt)("a",{parentName:"em",href:"https://www.github.com/wasp-lang/wasp"},"Wasp on GitHub"))," \ud83e\udd29"),(0,i.kt)("h2",{id:"background"},"Background"),(0,i.kt)("p",null,"Twitter is a great marketing tool. It\u2019s also a great way to explore ideas and refine your own. But it can be time-consuming and difficult to maintain a tweeting habit."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://media0.giphy.com/media/WSrR5xkvljaFMe7UPo/giphy.gif?cid=7941fdc6g9o3drj567dbwyuo1c66x76eq8awc2r1oop8oypl&ep=v1_gifs_search&rid=giphy.gif&ct=g",alt:"https://media0.giphy.com/media/WSrR5xkvljaFMe7UPo/giphy.gif?cid=7941fdc6g9o3drj567dbwyuo1c66x76eq8awc2r1oop8oypl&ep=v1_gifs_search&rid=giphy.gif&ct=g"})),(0,i.kt)("p",null,"That\u2019s why I decided to build my own personal twitter agent with ",(0,i.kt)("a",{parentName:"p",href:"https://js.langchain.com"},"LangChain")," on the basis of these assumptions:"),(0,i.kt)("p",null,"\ud83e\udde0\xa0LLMs (like ChatGPT) aren\u2019t the best writers, but they ARE great at brainstorming new ideas."),(0,i.kt)("p",null,"\ud83d\udcca\xa0Certain twitter users drive the majority of discourse within certain niches, i.e. trend-setters influence what\u2019s being discussed at the moment."),(0,i.kt)("p",null,"\ud83d\udca1\xa0the Agent needs context in order to generate ideas relevant to YOU and your opinions, so it should have access to your notes, ideas, tweets, etc."),(0,i.kt)("p",null,"So instead of trying to build a fully autonomous agent that does the tweeting for you, I thought it would be better to build an agent that does the BRAINSTORMING for you, based on your favorite trend-setting twitter users as well as your own ideas."),(0,i.kt)("p",null,"Imagine it like an intern that does the grunt work, while you do the curating!"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://media.giphy.com/media/26DNdV3b6dqn1jzR6/giphy.gif",alt:"https://media.giphy.com/media/26DNdV3b6dqn1jzR6/giphy.gif"})),(0,i.kt)("p",null,"In order to accomplish this, we need to take advantage of a few hot AI tools:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Embeddings and Vector Databases"),(0,i.kt)("li",{parentName:"ul"},"LLMs (Large Language Models), such as ChatGPT"),(0,i.kt)("li",{parentName:"ul"},"LangChain and sequential \u201cchains\u201d of LLM calls")),(0,i.kt)("p",null,"Embeddings and Vector Databases give us a powerful way to perform similarity searches on our own notes and ideas. "),(0,i.kt)("p",null,"If you\u2019re not familiar with ",(0,i.kt)("a",{parentName:"p",href:"https://www.pinecone.io/learn/what-is-similarity-search/"},"similarity search"),", the simplest way to describe what similarity search is by comparing it to a normal google search. In a normal search, the phrase \u201ca mouse eats cheese\u201d will return results with a combination of ",(0,i.kt)("strong",{parentName:"p"},"those")," ",(0,i.kt)("strong",{parentName:"p"},"words")," ",(0,i.kt)("strong",{parentName:"p"},"only"),". But a vector-based similarity search, on the other hand, would return those words, as well as results with related words such as \u201cdog\u201d, \u201ccat\u201d, \u201cbone\u201d, and \u201cfish\u201d."),(0,i.kt)("p",null,"You can see why that\u2019s so powerful, because if we have non-exact but related notes, our similarity search will still return them!"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://media2.giphy.com/media/xUySTD7evBn33BMq3K/giphy.gif?cid=7941fdc6273if8qfk83gbnv8uabc4occ0tnyzk0g0gfh0qg5&ep=v1_gifs_search&rid=giphy.gif&ct=g",alt:"https://media2.giphy.com/media/xUySTD7evBn33BMq3K/giphy.gif?cid=7941fdc6273if8qfk83gbnv8uabc4occ0tnyzk0g0gfh0qg5&ep=v1_gifs_search&rid=giphy.gif&ct=g"})),(0,i.kt)("p",null,"For example, if our favorite trend-setting twitter user makes a post about the benefits of typescript, but we only have a note on \u201cour favorite React hooks\u201d, our similarity search would still likely return such a result. And that\u2019s huge!"),(0,i.kt)("p",null,"Once we get those notes, we can pass them to the ChatGPT completion API along with a prompt to generate more ideas. The result from this prompt will then be sent to another prompt with instructions to generate a draft tweet. We save these sweet results to our Postgres relational database."),(0,i.kt)("p",null,"This \u201cchain\u201d of prompting is essentially where the LangChain package gets its name \ud83d\ude42"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"The flow of information through the app",src:n(86132).Z,width:"1451",height:"1562"})),(0,i.kt)("p",null,"This approach will give us a wealth of new ideas and tweet drafts related to our favorite trend-setting twitter users\u2019 tweets. We can look through these, edit and save our favorite ideas to our \u201cnotes\u201d vector store, or maybe send off some tweets."),(0,i.kt)("p",null,"I\u2019ve personally been using this app for a while now, and not only has it generated some great ideas, but it also helps to inspire new ones (even if some of the ideas it generates are \u201cmeh\u201d), which is why I included an \u201cAdd Note\u201d feature front and center to the nav bar"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"twitter-agent-add-note.png",src:n(6307).Z,width:"908",height:"288"})),(0,i.kt)("p",null,"Ok. Enough background. Let\u2019s start building your own personal twitter intern! \ud83e\udd16"),(0,i.kt)("p",null,"BTW, if you get stuck at all while following the tutorial, you can always reference this tutorial\u2019s repo, which has the finished app: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vincanger/twitter-intern"},"Twitter Intern GitHub Repo")),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("h3",{id:"set-up-your-wasp-project"},"Set up your Wasp project"),(0,i.kt)("p",null,"We\u2019re going to make this a full-stack React/NodeJS web app so we need to get that set up first. But don\u2019t worry, it won\u2019t take long AT ALL, because we will be using Wasp as the framework. "),(0,i.kt)("p",null,"Wasp does all the heavy lifting for us. You\u2019ll see what I mean in a second."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# First, install Wasp by running this in your terminal:\n\ncurl -sSL https://get.wasp-lang.dev/installer.sh | sh\n\n# next, create a new project:\n\nwasp new twitter-agent\n\n# cd into the new directory and start the project:\n\ncd twitter-agent && wasp start\n")),(0,i.kt)("p",null,"Great! When running ",(0,i.kt)("inlineCode",{parentName:"p"},"wasp start"),", Wasp will install all the necessary npm packages, start our server on port 3001, and our React client on port 3000. Head to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000"},"localhost:3000")," in your browser to check it out."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(34879).Z,width:"2090",height:"1142"})),(0,i.kt)("admonition",{title:"Tip \u2139\ufe0f",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"you can install the ",(0,i.kt)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=wasp-lang.wasp"},"Wasp vscode extension")," for the best developer experience.")),(0,i.kt)("p",null,"You\u2019ll notice Wasp sets up your full-stack app with a file structure like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 main.wasp             # The wasp config file.\n\u2514\u2500\u2500 src\n \xa0\xa0 \u251c\u2500\u2500 client            # Your React client code (JS/CSS/HTML) goes here.\n \xa0\xa0 \u251c\u2500\u2500 server            # Your server code (Node JS) goes here.\n \xa0\xa0 \u2514\u2500\u2500 shared            # Your shared (runtime independent) code goes here.\n")),(0,i.kt)("p",null,"Let\u2019s start adding some server-side code."),(0,i.kt)("h3",{id:"server-side--database-entities"},"Server-Side & Database Entities"),(0,i.kt)("p",null,"Start by adding a ",(0,i.kt)("inlineCode",{parentName:"p"},".env.server")," file in the root directory of your project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# https://platform.openai.com/account/api-keys\nOPENAI_API_KEY=\n\n# sign up for a free tier account at https://www.pinecone.io/\nPINECONE_API_KEY=\n# will be a location, e.g 'us-west4-gcp-free'\nPINECONE_ENV=   \n\n# We will fill these in later during the Twitter Scraping section\n# Twitter details -- only needed once for Rettiwt.account.login() to get the tokens \nTWITTER_EMAIL=\nTWITTER_HANDLE=\nTWITTER_PASSWORD=\n\n# TOKENS -- fill these in after running the getTwitterTokens script in the Twitter Scraping section\nKDT=\nTWID=\nCT0=\nAUTH_TOKEN=\n")),(0,i.kt)("p",null,"We need a way for us to store all our great ideas. So let\u2019s first head to ",(0,i.kt)("a",{parentName:"p",href:"http://Pinecone.io"},"Pinecone.io")," and set up a free trial account. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(88241).Z,width:"2582",height:"904"})),(0,i.kt)("p",null,"In the Pinecone dashboard, go to API keys and create a new one. Copy and paste your ",(0,i.kt)("inlineCode",{parentName:"p"},"Environment")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"API Key")," into ",(0,i.kt)("inlineCode",{parentName:"p"},".env.server")),(0,i.kt)("p",null,"Do the same for OpenAI, by creating an account and key at ",(0,i.kt)("a",{parentName:"p",href:"https://platform.openai.com/account/api-keys"},"https://platform.openai.com/account/api-keys")),(0,i.kt)("p",null,"Now let\u2019s replace the contents of the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," config file, which is like the \u201cskeleton\u201d of your app, with the code below. This will configure most of the fullstack app for you \ud83e\udd2f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'app twitterAgent {\n  wasp: {\n    version: "^0.10.6"\n  },\n  title: "twitter-agent",\n    head: [\n    "<script async src=\'https://platform.twitter.com/widgets.js\' charset=\'utf-8\'><\/script>"\n  ],\n  db: { \n    system: PostgreSQL,\n  },\n  auth: {\n    userEntity: User,\n    onAuthFailedRedirectTo: "/login",\n    methods: {\n      usernameAndPassword: {},\n    }\n  },\n  dependencies: [\n    ("openai", "3.2.1"),\n    ("rettiwt-api", "1.1.8"),\n    ("langchain", "0.0.91"),\n    ("@pinecone-database/pinecone", "0.1.6"),\n    ("@headlessui/react", "1.7.15"),\n    ("react-icons", "4.8.0"),\n        ("react-twitter-embed", "4.0.4")\n  ],\n}\n\n// ### Database Models\n\nentity Tweet {=psl\n    id              Int           @id @default(autoincrement())\n  tweetId         String        \n  authorUsername  String\n  content         String\n  tweetedAt       DateTime      @default(now())\n  user            User          @relation(fields: [userId], references: [id])\n  userId          Int\n  drafts          TweetDraft[]\n  ideas           GeneratedIdea[]\npsl=}\n\nentity TweetDraft {=psl\n  id              Int         @id @default(autoincrement())\n  content         String\n  notes           String\n  originalTweet   Tweet       @relation(fields: [originalTweetId], references: [id])\n  originalTweetId Int\n  createdAt       DateTime    @default(now())\n  user            User        @relation(fields: [userId], references: [id])\n  userId          Int\npsl=}\n\nentity GeneratedIdea {=psl\n  id              Int         @id @default(autoincrement())\n  content         String\n  createdAt       DateTime    @default(now())\n  updatedAt       DateTime    @default(now())\n  user            User        @relation(fields: [userId], references: [id])\n  userId          Int\n  originalTweet   Tweet?      @relation(fields: [originalTweetId], references: [id])\n  originalTweetId Int?\n  isEmbedded      Boolean     @default(false)\npsl=}\n\nentity User {=psl\n  id              Int         @id @default(autoincrement())\n  username        String      @unique\n  password        String\n  createdAt       DateTime    @default(now())\n  favUsers        String[]\n  originalTweets  Tweet[]\n  tweetDrafts     TweetDraft[]\n  generatedIdeas  GeneratedIdea[]\npsl=}\n\n// <<< Client Pages & Routes\n\nroute RootRoute { path: "/", to: MainPage }\npage MainPage {\n  authRequired: true,\n  component: import Main from "@client/MainPage"\n}\n\n//...\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You might have noticed this ",(0,i.kt)("inlineCode",{parentName:"p"},"{=psl psl=}")," syntax in the entities above. This denotes that anything in between these ",(0,i.kt)("inlineCode",{parentName:"p"},"psl")," brackets is actually a different language, in this case, ",(0,i.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/concepts/components/prisma-schema"},"Prisma Schema Language"),". Wasp uses Prisma under the hood, so if you've used Prisma before, it should be straightforward.")),(0,i.kt)("p",null,"As you can see, our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," config file has our:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"dependencies, "),(0,i.kt)("li",{parentName:"ul"},"authentication method, "),(0,i.kt)("li",{parentName:"ul"},"database type, and "),(0,i.kt)("li",{parentName:"ul"},"database models (\u201dentities\u201d)")),(0,i.kt)("p",null,"With this, our app structure is mostly defined and Wasp will take care of a ton of configuration for us."),(0,i.kt)("h3",{id:"database-setup"},"Database Setup"),(0,i.kt)("p",null,"But we still need to get a postgres database running. Usually this can be pretty annoying, but with Wasp, just have ",(0,i.kt)("a",{parentName:"p",href:"https://www.docker.com/products/docker-desktop/"},"Docker Deskop")," installed and running, then open up ",(0,i.kt)("strong",{parentName:"p"},"another separate terminal tab/window")," and then run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wasp start db\n")),(0,i.kt)("p",null,"This will start and connect your app to a Postgres database for you. No need to do anything else! \ud83e\udd2f\xa0Just leave this terminal tab, along with docker desktop, open and running in the background."),(0,i.kt)("p",null,"In a different terminal tab, run: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wasp db migrate-dev\n")),(0,i.kt)("p",null,"and make sure to give your database migration a name."),(0,i.kt)("p",null,"If you stopped the wasp dev server to run this command, go ahead and start it again with ",(0,i.kt)("inlineCode",{parentName:"p"},"wasp start"),"."),(0,i.kt)("p",null,"At this point, our app will be navigating us to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000/login"},"localhost:3000/login")," but because we haven\u2019t implemented a login screen/flow yet, we will be seeing a blank screen. Don\u2019t worry, we\u2019ll get to that."),(0,i.kt)("h2",{id:"embedding-ideas--notes"},"Embedding Ideas & Notes"),(0,i.kt)("h3",{id:"server-action"},"Server Action"),(0,i.kt)("p",null,"First though, in the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," config file, let\u2019s define a server action for saving notes and ideas. Go ahead and add the code below to the bottom of the file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'// main.wasp\n\n//...\n// <<< Client Pages & Routes\n\nroute RootRoute { path: "/", to: MainPage }\npage MainPage {\n  authRequired: true,\n  component: import Main from "@client/MainPage"\n}\n\n// !!! Actions\n\naction embedIdea {\n  fn: import { embedIdea } from "@server/ideas.js",\n  entities: [GeneratedIdea]\n}\n')),(0,i.kt)("p",null,"With the action declared, let\u2019s create it. Make a new file, ",(0,i.kt)("inlineCode",{parentName:"p"},".src/server/ideas.ts")," in and add the following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import type { EmbedIdea } from '@wasp/actions/types';\nimport type { GeneratedIdea } from '@wasp/entities';\nimport HttpError from '@wasp/core/HttpError.js';\nimport { PineconeStore } from 'langchain/vectorstores/pinecone';\nimport { Document } from 'langchain/document';\nimport { OpenAIEmbeddings } from 'langchain/embeddings/openai';\nimport { PineconeClient } from '@pinecone-database/pinecone';\n\nconst pinecone = new PineconeClient();\nexport const initPinecone = async () => {\n  await pinecone.init({\n    environment: process.env.PINECONE_ENV!,\n    apiKey: process.env.PINECONE_API_KEY!,\n  });\n  return pinecone;\n};\n\nexport const embeddings = new OpenAIEmbeddings({\n  openAIApiKey: process.env.OPENAI_API_KEY,\n});\n\n/**\n * Embeds a single idea into the vector store\n */\nexport const embedIdea: EmbedIdea<{ idea: string }, GeneratedIdea> = async ({ idea }, context) => {\n  if (!context.user) {\n    throw new HttpError(401, 'User is not authorized');\n  }\n\n  console.log('idea: ', idea);\n\n  try {\n    let newIdea = await context.entities.GeneratedIdea.create({\n        data: {\n          content: idea,\n          userId: context.user.id,\n        },\n      });\n    \n\n    if (!newIdea) {\n      throw new HttpError(404, 'Idea not found');\n    }\n\n    const pinecone = await initPinecone();\n        \n    // we need to create an index to save the vector embeddings to\n    // an index is similar to a table in relational database world\n    const availableIndexes = await pinecone.listIndexes();\n    if (!availableIndexes.includes('embeds-test')) {\n      console.log('creating index');\n      await pinecone.createIndex({\n        createRequest: {\n          name: 'embeds-test',\n          // open ai uses 1536 dimensions for their embeddings\n          dimension: 1536, \n        },\n      });\n    }\n\n    const pineconeIndex = pinecone.Index('embeds-test');\n        \n    // the LangChain vectorStore wrapper\n    const vectorStore = new PineconeStore(embeddings, {\n      pineconeIndex: pineconeIndex,\n      namespace: context.user.username,\n    });\n        \n    // create a document with the idea's content to be embedded\n    const ideaDoc = new Document({\n      metadata: { type: 'note' },\n      pageContent: newIdea.content,\n    });\n        \n    // add the document to the vectore store along with its id\n    await vectorStore.addDocuments([ideaDoc], [newIdea.id.toString()]);\n\n    newIdea = await context.entities.GeneratedIdea.update({\n      where: {\n        id: newIdea.id,\n      },\n      data: {\n        isEmbedded: true,\n      },\n    });\n    console.log('idea embedded successfully!', newIdea);\n    return newIdea;\n  } catch (error: any) {\n    throw new Error(error);\n  }\n};\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"We\u2019ve defined the action function in our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file as coming from \u2018@server/ideas.js\u2019 but we\u2019re creating an ",(0,i.kt)("inlineCode",{parentName:"p"},"ideas.ts")," file. What's up with that?!"),(0,i.kt)("p",{parentName:"admonition"},"Well, Wasp internally uses\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"esnext"),"\xa0module resolution, which always requires specifying the extension as\xa0",(0,i.kt)("inlineCode",{parentName:"p"},".js"),"\xa0(i.e., the extension used in the emitted JS file). This applies to all\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"@server"),"\xa0imports (and files on the server in general). It does not apply to client files.")),(0,i.kt)("p",null,"Great! Now we have a server action for adding notes and ideas to our vector database. And we didn\u2019t even have to configure a server ourselves (thanks, Wasp \ud83d\ude42)."),(0,i.kt)("p",null,"Let's take a step back and walk through the code we just wrote though:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"We create a new Pinecone client and initialize it with our API key and environment."),(0,i.kt)("li",{parentName:"ol"},"We create a new OpenAIEmbeddings client and initialize it with our OpenAI API key."),(0,i.kt)("li",{parentName:"ol"},"We create a new index in our Pinecone database to store our vector embeddings."),(0,i.kt)("li",{parentName:"ol"},"We create a new PineconeStore, which is a LangChain wrapper around our Pinecone client and our OpenAIEmbeddings client."),(0,i.kt)("li",{parentName:"ol"},"We create a new Document with the idea\u2019s content to be embedded."),(0,i.kt)("li",{parentName:"ol"},"We add the document to the vector store along with its id."),(0,i.kt)("li",{parentName:"ol"},"We also update the idea in our Postgres database to mark it as embedded.")),(0,i.kt)("p",null,"Now we want to create the client-side functionality for adding ideas, but you\u2019ll remember we defined an ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," object in our wasp config file. So we\u2019ll need to add the ability to log in before we do anything on the frontend. "),(0,i.kt)("h3",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"Let\u2019s add that quickly by adding a new a Route and Page definition to our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'//...\n\nroute LoginPageRoute { path: "/login", to: LoginPage }\npage LoginPage {\n  component: import Login from "@client/LoginPage"\n}\n')),(0,i.kt)("p",null,"\u2026and create the file ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/LoginPage.tsx")," with the following content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { LoginForm } from '@wasp/auth/forms/Login';\nimport { SignupForm } from '@wasp/auth/forms/Signup';\nimport { useState } from 'react';\n\nexport default () => {\n  const [showSignupForm, setShowSignupForm] = useState(false);\n\n  const handleShowSignupForm = () => {\n    setShowSignupForm((x) => !x);\n  };\n\n  return (\n    <>\n      {showSignupForm ? <SignupForm /> : <LoginForm />}\n      <div onClick={handleShowSignupForm} className='underline cursor-pointer hover:opacity-80'>\n        {showSignupForm ? 'Already Registered? Login!' : 'No Account? Sign up!'}\n      </div>\n    </>\n  );\n};\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," object on the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file, we used the ",(0,i.kt)("inlineCode",{parentName:"p"},"usernameAndPassword")," method which is the simplest form of auth Wasp offers. If you\u2019re interested, ",(0,i.kt)("a",{parentName:"p",href:"https://wasp-lang.dev/docs"},"Wasp")," does provide abstractions for Google, Github, and Email Verified Authentication, but we will stick with the simplest auth for this tutorial.")),(0,i.kt)("p",null,"With authentication all set up, if we try to go to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000"},"localhost:3000")," we will be automatically directed to the login/register form."),(0,i.kt)("p",null,"You\u2019ll see that Wasp creates Login and Signup forms for us because of the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," object we defined in the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file. Sweet! \ud83c\udf89"),(0,i.kt)("p",null,"But even though we\u2019ve added some style classes, we haven\u2019t set up any css styling so it will probably be pretty ugly right about now. "),(0,i.kt)("p",null,"\ud83e\udd22\xa0Barf."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(93471).Z,width:"2154",height:"776"})),(0,i.kt)("h3",{id:"adding-tailwind-css"},"Adding Tailwind CSS"),(0,i.kt)("p",null,"Luckily, Wasp comes with tailwind css support, so all we have to do to get that working is add the following files in the root directory of the project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 main.wasp            \n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 client            \n\u2502   \u251c\u2500\u2500 server           \n\u2502   \u2514\u2500\u2500 shared            \n\u251c\u2500\u2500 postcss.config.cjs       # add this file here\n\u251c\u2500\u2500 tailwind.config.cjs      # and this here too\n\u2514\u2500\u2500 .wasproot\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"postcss.config.cjs")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"module.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"tailwind.config.cjs")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: ['./src/**/*.{js,jsx,ts,tsx}'],\n  theme: {\n    extend: {},\n  },\n  plugins: [],\n};\n")),(0,i.kt)("p",null,"Finally, replace the contents of your ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/Main.css")," file with these lines:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-css"},"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n")),(0,i.kt)("p",null,"Now we\u2019ve got the magic of ",(0,i.kt)("a",{parentName:"p",href:"https://tailwindcss.com/"},"tailwind css")," on our sides! \ud83c\udfa8\xa0We\u2019ll get to styling later though. Patience, young grasshopper."),(0,i.kt)("h3",{id:"adding-notes-client-side"},"Adding Notes Client-side"),(0,i.kt)("p",null,"From here, let\u2019s create the complimentary client-side components for adding notes to the vector store. Create a new ",(0,i.kt)("inlineCode",{parentName:"p"},".src/client/AddNote.tsx")," file with the following contents:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useState } from 'react';\nimport embedIdea from '@wasp/actions/embedIdea';\n\nexport default function AddNote() {\n  const [idea, setIdea] = useState('');\n  const [isIdeaEmbedding, setIsIdeaEmbedding] = useState(false);\n\n  const handleEmbedIdea = async (e: any) => {\n    try {\n      setIsIdeaEmbedding(true);\n      if (!idea) {\n        throw new Error('Idea cannot be empty');\n      }\n      const embedIdeaResponse = await embedIdea({\n        idea,\n      });\n\n      console.log('embedIdeaResponse: ', embedIdeaResponse);\n    } catch (error: any) {\n      alert(error.message);\n    } finally {\n      setIdea('');\n      setIsIdeaEmbedding(false);\n    }\n  };\n\n  return (\n    <div className='flex flex-row gap-2 justify-center items-end w-full'>\n      <textarea\n        autoFocus\n        onChange={(e) => setIdea(e.target.value)}\n        value={idea}\n        placeholder='LLMs are great for brainstorming!'\n        className='w-full p-4 h-22 bg-neutral-100 border rounded-lg w-full'\n      />\n      <button\n        onClick={handleEmbedIdea}\n        className='flex flex-row justify-center items-center bg-neutral-100 hover:bg-neutral-200 border border-neutral-300 font-bold px-3 py-1 text-sm text-blue-500 whitespace-nowrap rounded-lg'\n      >\n        {isIdeaEmbedding ? 'Loading...' : 'Save Note'}\n      </button>\n    </div>\n  );\n}\n")),(0,i.kt)("p",null,"Here we\u2019re using the ",(0,i.kt)("inlineCode",{parentName:"p"},"embedIdea")," action we defined earlier to add our idea to the vector store. We\u2019re also using the ",(0,i.kt)("inlineCode",{parentName:"p"},"useState")," hook to keep track of the idea we\u2019re adding, as well as the loading state of the button."),(0,i.kt)("p",null,"So now we have a way to add our own ideas and notes to our vector store. Pretty sweet!"),(0,i.kt)("h2",{id:"generating-new-ideas--tweet-drafts"},"Generating New Ideas & Tweet Drafts"),(0,i.kt)("h3",{id:"using-langchains-sequential-chains"},"Using LangChain's Sequential Chains"),(0,i.kt)("p",null,"Now we need to set up the sequential chain of LLM calls that LangChain is so great at."),(0,i.kt)("p",null,"Here are the steps we will take:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"define a function that uses LangChain to initiate a \u201cchain\u201d of API calls to OpenAI\u2019s ChatGPT completions endpoint.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"this function takes a tweet that we pulled from one of our favorite twitter users as an argument, searches our vector store for similar notes & ideas, and returns a list of new \u201cbrainstormed\u201d based on the example tweet and our notes."))),(0,i.kt)("li",{parentName:"ol"},"define a new action that loops through our favorite users array, pulls their most recent tweets, and sends them to our LangChain function mentioned above")),(0,i.kt)("p",null,"So let\u2019s start again by creating our LangChain function. Make a new ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/chain.ts")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { ChatOpenAI } from 'langchain/chat_models/openai';\nimport { LLMChain, SequentialChain } from 'langchain/chains';\nimport { PromptTemplate } from 'langchain/prompts';\nimport { PineconeStore } from 'langchain/vectorstores/pinecone';\nimport { OpenAIEmbeddings } from 'langchain/embeddings/openai';\nimport { PineconeClient } from '@pinecone-database/pinecone';\n\nconst pinecone = new PineconeClient();\nexport const initPinecone = async () => {\n  await pinecone.init({\n    environment: process.env.PINECONE_ENV!,\n    apiKey: process.env.PINECONE_API_KEY!,\n  });\n  return pinecone;\n};\n\nconst embeddings = new OpenAIEmbeddings({\n  openAIApiKey: process.env.OPENAI_API_KEY,\n});\n\nexport const generateIdeas = async (exampleTweet: string, username: string) => {\n  try {\n    // remove quotes and curly braces as not to confuse langchain template parser\n    exampleTweet = exampleTweet.replace(/\"/g, '');\n    exampleTweet = exampleTweet.replace(/{/g, '');\n    exampleTweet = exampleTweet.replace(/}/g, '');\n\n    const pinecone = await initPinecone();\n\n    console.log('list indexes', await pinecone.listIndexes());\n\n    // find the index we created earlier\n    const pineconeIndex = pinecone.Index('embeds-test');\n\n    const vectorStore = new PineconeStore(embeddings, {\n      pineconeIndex: pineconeIndex,\n      namespace: username,\n    });\n\n    //\n    // sequential tweet chain begin --- >\n    //\n    /**\n     * vector store results for notes similar to the original tweet\n     */\n    const searchRes = await vectorStore.similaritySearchWithScore(exampleTweet, 2);\n    console.log('searchRes: ', searchRes);\n    let notes = searchRes\n      .filter((res) => res[1] > 0.7) // filter out strings that have less than %70 similarity\n      .map((res) => res[0].pageContent)\n      .join(' ');\n\n    console.log('\\n\\n similarity search results of our notes-> ', notes);\n\n        if (!notes || notes.length <= 2) {\n      notes = exampleTweet;\n    }\n\n    const tweetLlm = new ChatOpenAI({\n      openAIApiKey: process.env.OPENAI_API_KEY,\n      temperature: 0.8, // 0 - 2 with 0 being more deterministic and 2 being most \"loose\". Past 1.3 the results tend to be more incoherent.\n      modelName: 'gpt-3.5-turbo',\n    });\n\n    const tweetTemplate = `You are an expert idea generator. You will be given a user's notes and your goal is to use this information to brainstorm other novel ideas. \n\n      Notes: {notes}\n    \n      Ideas Brainstorm: \n      -`;\n\n    const tweetPromptTemplate = new PromptTemplate({\n      template: tweetTemplate,\n      inputVariables: ['notes'],\n    });\n\n    const tweetChain = new LLMChain({\n      llm: tweetLlm,\n      prompt: tweetPromptTemplate,\n      outputKey: 'newTweetIdeas',\n    });\n\n    const interestingTweetTemplate = `You are an expert interesting tweet generator. You will be given some tweet ideas and your goal is to choose one, and write a tweet based on it. Structure the tweet in an informal yet serious tone and do NOT include hashtags in the tweet!\n \n      Tweet Ideas: {newTweetIdeas}\n      \n      Interesting Tweet:`;\n\n    const interestingTweetLlm = new ChatOpenAI({\n      openAIApiKey: process.env.OPENAI_API_KEY,\n      temperature: 1.1,\n      modelName: 'gpt-3.5-turbo',\n    });\n\n    const interestingTweetPrompt = new PromptTemplate({\n      template: interestingTweetTemplate,\n      inputVariables: ['newTweetIdeas'],\n    });\n\n    const interestingTweetChain = new LLMChain({\n      llm: interestingTweetLlm,\n      prompt: interestingTweetPrompt,\n      outputKey: 'interestingTweet',\n    });\n\n    const overallChain = new SequentialChain({\n      chains: [tweetChain, interestingTweetChain],\n      inputVariables: ['notes'],\n      outputVariables: ['newTweetIdeas', 'interestingTweet'],\n      verbose: false,\n    });\n\n    type ChainDraftResponse = {\n      newTweetIdeas: string;\n      interestingTweet: string;\n      notes: string;\n    };\n\n    const res1 = (await overallChain.call({\n      notes,\n    })) as ChainDraftResponse;\n\n    return {\n      ...res1,\n      notes,\n    };\n  } catch (error: any) {\n    throw new Error(error);\n  }\n};\n")),(0,i.kt)("p",null,"Great! Let's run through the above code real quick:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Initialize the Pinecone client"),(0,i.kt)("li",{parentName:"ol"},"Find our pinecone index (i.e. table) that we created earlier and initialize a new PineconeStore with LangChain"),(0,i.kt)("li",{parentName:"ol"},"Search our vector store for notes similar to the example tweet, filtering out any results that have less than %70 similarity"),(0,i.kt)("li",{parentName:"ol"},"Create a new ChatGPT completion chain that takes our notes as input and generates new tweet ideas"),(0,i.kt)("li",{parentName:"ol"},"Create a new ChatGPT completion chain that takes the new tweet ideas as input and generates a new tweet draft"),(0,i.kt)("li",{parentName:"ol"},"Create a new SequentialChain and combine the above two chains together so that we can pass it our notes as input and it returns the new tweet ideas and the new tweet draft as output")),(0,i.kt)("admonition",{title:"VECTOR COSINE SIMILARITY SCORES",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"A good similarity threshold for cosine similarity search on text strings depends on the specific application and the desired level of strictness in matching. Cosine similarity scores range between 0 and 1, with 0 meaning no similarity and 1 meaning completely identical text strings."),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"0.8-0.9 = strict"),(0,i.kt)("li",{parentName:"ul"},"0.6-0.8 = moderate"),(0,i.kt)("li",{parentName:"ul"},"0.5 = relaxed.")),(0,i.kt)("p",{parentName:"admonition"},"In our case, we went for a moderate similarity threshold of 0.7, which means that we will only return notes that are at least 70% similar to the example tweet.")),(0,i.kt)("p",null,"With this function, we will get our ",(0,i.kt)("inlineCode",{parentName:"p"},"newTweetIdeas")," and our ",(0,i.kt)("inlineCode",{parentName:"p"},"interestingTweet")," draft back as results that we can use within our server-side action."),(0,i.kt)("h3",{id:"scraping-twitter"},"Scraping Twitter"),(0,i.kt)("p",null,"Before we can pass an ",(0,i.kt)("inlineCode",{parentName:"p"},"exampleTweet")," as an argument to our newly created Sequential Chain, we need to fetch it first!"),(0,i.kt)("p",null,"To do this, we're going to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"Rettiwt-Api")," (which is just Twitter written backwards). Because it's an unofficial API there are a few caveats:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"We have to use the rettiwt client to login to our twitter account once. We will output the tokens it returns via a script and save those in our ",(0,i.kt)("inlineCode",{parentName:"li"},".env.server")," file for later."),(0,i.kt)("li",{parentName:"ol"},"It's best to use an alternative account for this process. If you don't have an alternative account, go ahead and register a new one now.")),(0,i.kt)("admonition",{title:"\u26a0\ufe0f ",type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"The use of an unofficial Twitter client, Rettiwt, is for illustrative purposes only. It's crucial that you familiarize yourself with Twitter's policies and rules regarding scraping before implementing these methods. Any abuse or misuse of these scripts and techniques may lead to actions taken against your Twitter account. We hold no responsibility for any consequences arising from your personal use of this tutorial and/or the related scripts. It is intended purely for learning and educational purposes.")),(0,i.kt)("p",null,"Let's go ahead and create a new folder in ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server")," called ",(0,i.kt)("inlineCode",{parentName:"p"},"scripts")," with a file inside called ",(0,i.kt)("inlineCode",{parentName:"p"},"tokens.ts"),". This will be our script that we will run only once, just so that we get the necessary tokens to pass to our Rettiwt client."),(0,i.kt)("p",null,"We want to avoid running this script many times otherwise our account could get rate-limited. This shouldn't be an issue though, because once we return the tokens, they are valid for up to a year."),(0,i.kt)("p",null,"So inside ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/scripts/tokens.ts")," add the following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import { Rettiwt } from 'rettiwt-api'; \n\n/**\n * This is a script we can now run from the cli with `wasp db seed`\n * IMPORTANT! We only want to run this script once, after which we save the tokens\n * in the .env.server file. They should be good for up to a year.\n */\nexport const getTwitterTokens = async () => {\n  const tokens = await Rettiwt().account.login(\n    process.env.TWITTER_EMAIL!,\n    process.env.TWITTER_HANDLE!,\n    process.env.TWITTER_PASSWORD!\n  );\n\n  console.log('tokens: ', tokens)\n};\n")),(0,i.kt)("p",null,"Make sure to add your twitter login details to our ",(0,i.kt)("inlineCode",{parentName:"p"},".env.server")," file, if you haven't already!"),(0,i.kt)("p",null,"Great. To be able to run this script via a simple Wasp CLI command, add it via the ",(0,i.kt)("inlineCode",{parentName:"p"},"seeds")," array within the ",(0,i.kt)("inlineCode",{parentName:"p"},"db")," object at the top of your ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'app twitterAgent {\n  wasp: {\n    version: "^0.10.6"\n  },\n  //...\n  db: { \n    system: PostgreSQL,\n    seeds: [ // <---------- add this\n      import { getTwitterTokens } from "@server/scripts/tokens.js",\n    ]\n  },\n  //...\n')),(0,i.kt)("p",null,"Nice! Now for the fun part :)"),(0,i.kt)("p",null,"in your terminal, at the root of your project, run ",(0,i.kt)("inlineCode",{parentName:"p"},"wasp db seed"),", and you should see the tokens output to the terminal similar to this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plaintext"},"[Db]      Running seed: getTwitterTokens\n[Db]      tokens:  { // your tokens... }\n")),(0,i.kt)("p",null,"Copy and paste those tokens into your ",(0,i.kt)("inlineCode",{parentName:"p"},".env.server")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plaintext"},"\n# TOKENS -- fill these in after running the getTwitterTokens script in the Twitter Scraping section\nKDT='...'\nTWID='...'\nCT0='...'\nAUTH_TOKEN='...'\n")),(0,i.kt)("p",null,"Now with that, we should be able to access our favorite trend-setting users' recent tweets and use them to help us brainstorm new ideas!"),(0,i.kt)("h3",{id:"server-action-1"},"Server Action"),(0,i.kt)("p",null,"Ok, so we've got the tokens we need to get our trend-setting example tweets, and we've got a function that runs our similarity search and sequential chain of LLM calls."),(0,i.kt)("p",null,"Now let\u2019s define an action in our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file that pulls it all together:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'// actions...\n\naction generateNewIdeas {\n  fn: import { generateNewIdeas } from "@server/ideas.js",\n  entities: [GeneratedIdea, Tweet, TweetDraft, User]\n}\n')),(0,i.kt)("p",null,"\u2026and then create that action within ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/ideas.ts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"\nimport type { \n    EmbedIdea,\n    GenerateNewIdeas // < ---- add this type here -----\n } from '@wasp/actions/types';\n// ... other imports ...\nimport { generateIdeas } from './chain.js'; // < ---- this too -----\nimport { Rettiwt } from 'rettiwt-api'; // < ---- and this here -----\n\nconst twitter = Rettiwt({ // < ---- and this -----\n  kdt: process.env.KDT!,\n  twid: process.env.TWID!,\n  ct0:  process.env.CT0!,\n  auth_token: process.env.AUTH_TOKEN!,\n}); \n\n//... other stuff ...\n\nexport const generateNewIdeas: GenerateNewIdeas<unknown, void> = async (_args, context) => {\n    try {\n    // get the logged in user that Wasp passes to the action via the context\n    const user = context.user\n\n    if (!user) {\n      throw new HttpError(401, 'User is not authorized');\n    }\n\n      for (let h = 0; h < user.favUsers.length; h++) {\n        const favUser = user.favUsers[h];\n        const oneDayFromNow = new Date(Date.now() + 24 * 60 * 60 * 1000);\n        // convert oneDayFromNow to format YYYY-MM-DD\n        const endDate = oneDayFromNow.toISOString().split('T')[0];\n\n        // find the most recent tweet from the favUser\n        const mostRecentTweet = await context.entities.Tweet.findFirst({\n          where: {\n            authorUsername: favUser,\n          },\n          orderBy: {\n            tweetedAt: 'desc',\n          },\n        });\n\n        console.log('mostRecentTweet: ', mostRecentTweet)\n\n        const favUserTweets = await twitter.tweets.getTweets({\n          fromUsers: [favUser],\n          sinceId: mostRecentTweet?.tweetId || undefined, // get tweets since the most recent tweet if it exists\n          endDate: endDate, // endDate in format YYYY-MM-DD\n        });\n\n        const favUserTweetTexts = favUserTweets.list\n\n        for (let i = 0; i < favUserTweetTexts.length; i++) {\n          const tweet = favUserTweetTexts[i];\n\n          const existingTweet = await context.entities.User.findFirst({\n            where: {\n              id: user.id,\n            },\n            select: {\n              originalTweets: {\n                where: {\n                  tweetId: tweet.id,\n                },\n              },\n            },\n          });\n\n          /** \n           * If the tweet already exists in the database, skip generating drafts and ideas for it.\n           */\n          if (existingTweet) {\n            console.log('tweet already exists in db, skipping generating drafts...');\n            continue;\n          }\n          \n          /**\n           * this is where the magic happens\n           */\n          const draft = await generateIdeas(tweet.fullText, user.username);\n          console.log('draft: ', draft);\n\n          const originalTweet = await context.entities.Tweet.create({\n            data: {\n              tweetId: tweet.id,\n              content: tweet.fullText,\n              authorUsername: favUser,\n              tweetedAt: new Date(tweet.createdAt),\n              userId: user.id\n            },\n          });\n\n          let newTweetIdeas = draft.newTweetIdeas.split('\\n');\n          newTweetIdeas = newTweetIdeas\n            .filter((idea) => idea.trim().length > 0)\n            .map((idea) => {\n              // remove all dashes that are not directly followed by a letter\n              idea = idea.replace(/-(?![a-zA-Z])/g, '');\n              idea = idea.replace(/\"/g, '');\n              idea = idea.replace(/{/g, '');\n              idea = idea.replace(/}/g, '');\n              // remove hashtags and the words that follow them\n              idea = idea.replace(/#[a-zA-Z0-9]+/g, '');\n              idea = idea.replace(/^\\s*[\\r\\n]/gm, ''); // remove new line breaks\n              idea = idea.trim();\n              // check if last character contains punctuation and if not add a period\n              if (idea.length > 1 && !idea[idea.length - 1].match(/[.,\\/#!$%\\^&\\*;:{}=\\-_`~()]/g)) {\n                idea += '.';\n              }\n              return idea;\n            });\n          for (let j = 0; j < newTweetIdeas.length; j++) {\n            const newTweetIdea = newTweetIdeas[j];\n            const newIdea = await context.entities.GeneratedIdea.create({\n              data: {\n                content: newTweetIdea,\n                originalTweetId: originalTweet.id,\n                userId: user.id\n              },\n            });\n            console.log('newIdea saved to DB: ', newIdea);\n          }\n\n          const interestingTweetDraft = await context.entities.TweetDraft.create({\n            data: {\n              content: draft.interestingTweet,\n              originalTweetId: originalTweet.id,\n              notes: draft.notes,\n              userId: user.id\n            },\n          });\n\n          console.log('interestingTweetDraft saved to DB: ', interestingTweetDraft);\n\n          // create a delay to avoid rate limiting\n          await new Promise((resolve) => setTimeout(resolve, 1000));\n\n        }\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n      }\n\n  } catch (error: any) {\n    console.log('error', error);\n    throw new HttpError(500, error);\n  }\n}\n")),(0,i.kt)("p",null,"Ok! Nice work. There\u2019s a lot going on above, so let\u2019s just recap:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"We loop through the array of our favorite users, as defined on our user entity in ",(0,i.kt)("inlineCode",{parentName:"li"},"main.wasp"),","),(0,i.kt)("li",{parentName:"ul"},"Pull that user\u2019s most recent tweets"),(0,i.kt)("li",{parentName:"ul"},"Send that tweet to our ",(0,i.kt)("inlineCode",{parentName:"li"},"generateIdeas")," function, which",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"searches our vector store for similar notes"),(0,i.kt)("li",{parentName:"ul"},"asks GPT to generate similar, new ideas"),(0,i.kt)("li",{parentName:"ul"},"sends those ideas in another prompt GPT to create a new, interesting tweet"),(0,i.kt)("li",{parentName:"ul"},"returns the new ideas and interesting tweet"))),(0,i.kt)("li",{parentName:"ul"},"Create new ",(0,i.kt)("inlineCode",{parentName:"li"},"GeneratedIdeas")," and a ",(0,i.kt)("inlineCode",{parentName:"li"},"TweetDraft")," and saves them to our Postgres DB")),(0,i.kt)("p",null,"Phew! We\u2019re doing it \ud83d\udcaa\xa0"),(0,i.kt)("h2",{id:"fetching--displaying-ideas"},"Fetching & Displaying Ideas"),(0,i.kt)("h3",{id:"defining-a-server-side-query"},"Defining a Server-side Query"),(0,i.kt)("p",null,"Since we now have our chain of GPT prompts defined via LangChain and our server-side action, let\u2019s go ahead and start implementing some front-end logic to fetch that data and display it to our users\u2026 which is basically only us at this point \ud83e\udec2."),(0,i.kt)("p",null,"Just as we added a server-side action to ",(0,i.kt)("inlineCode",{parentName:"p"},"generateNewIdeas")," we will now define a query to fetch those ideas."),(0,i.kt)("p",null,"Add the following query to your ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'query getTweetDraftsWithIdeas {\n  fn: import { getTweetDraftsWithIdeas } from "@server/ideas.js",\n  entities: [TweetDraft]\n}\n')),(0,i.kt)("p",null,"In your ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/ideas.ts")," file, below your ",(0,i.kt)("inlineCode",{parentName:"p"},"generateNewIdeas")," action, add the query we just defined in our wasp file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"//... other imports ...\nimport type { GetTweetDraftsWithIdeas } from '@wasp/queries/types'; // <--- add this ---\n\n// ... other functions ...\n\ntype TweetDraftsWithIdeas = {\n  id: number;\n  content: string;\n  notes: string;\n  createdAt: Date;\n  originalTweet: {\n    id: number;\n    content: string;\n    tweetId: string;\n    tweetedAt: Date;\n    ideas: GeneratedIdea[];\n    authorUsername: string;\n  };\n}[];\n\nexport const getTweetDraftsWithIdeas: GetTweetDraftsWithIdeas<unknown, TweetDraftsWithIdeas> = async (_args, context) => {\n  if (!context.user) {\n    throw new HttpError(401, 'User is not authorized');\n  }\n\n  const drafts = await context.entities.TweetDraft.findMany({\n    orderBy: {\n      originalTweet: {\n        tweetedAt: 'desc',\n      }\n    },\n    where: {\n      userId: context.user.id,\n      createdAt: {\n        gte: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // Get drafts created within the last 2 days\n      },\n    },\n    select: {\n      id: true,\n      content: true,\n      notes: true,\n      createdAt: true,\n      originalTweet: {\n        select: {\n          id: true,\n          tweetId: true,\n          content: true,\n          ideas: true,\n          tweetedAt: true,\n                    authorUsername: true,\n        },\n      },\n    },\n  });\n\n  return drafts;\n};\n")),(0,i.kt)("p",null,"With this function we will be returning the tweet drafts we generate, along with our notes, the original tweet that inspired it, and the newly generated ideas. "),(0,i.kt)("p",null,"Sweet!"),(0,i.kt)("p",null,"Ok, but what good is a function that fetches the data if we\u2019ve got nowhere to display it!? "),(0,i.kt)("h3",{id:"displaying-ideas-client-side"},"Displaying Ideas Client-side"),(0,i.kt)("p",null,"Let\u2019s go now to our ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/MainPage.tsx")," file (make sure it\u2019s got the ",(0,i.kt)("inlineCode",{parentName:"p"},".tsx")," extension and not ",(0,i.kt)("inlineCode",{parentName:"p"},".jsx"),") and replace the contents with these below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import waspLogo from './waspLogo.png'\nimport './Main.css'\n\nconst MainPage = () => {\n  return (\n    <div className='min-h-screen bg-neutral-300/70 text-center'>\n      <div className='flex flex-col justify-center items-center mx-auto pt-12'>\n        <img src={waspLogo} className='w-5' />\n      </div>\n    </div>\n  )\n}\nexport default MainPage\n")),(0,i.kt)("p",null,"At this point, you. might need to restart the wasp dev server running in your terminal to get the tailwind configuration to take effect (ctrl + c, then ",(0,i.kt)("inlineCode",{parentName:"p"},"wasp start")," again)."),(0,i.kt)("p",null,"You\u2019ll now be prompted with the login / register screen. Go ahead and click on ",(0,i.kt)("inlineCode",{parentName:"p"},"register")," and you will be automatically logged in and redirected to the main page, which at this point only has this:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(28613).Z,width:"1344",height:"454"})),(0,i.kt)("p",null,"Let\u2019s go back to our ",(0,i.kt)("inlineCode",{parentName:"p"},"MainPage.tsx")," file and add the magic!"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://media3.giphy.com/media/ekv45izCuyXkXoHRaL/giphy.gif?cid=7941fdc6c3dszwj4xaoxg2kyj6xxdubjxn69m4qruhomhkut&ep=v1_gifs_search&rid=giphy.gif&ct=g",alt:"https://media3.giphy.com/media/ekv45izCuyXkXoHRaL/giphy.gif?cid=7941fdc6c3dszwj4xaoxg2kyj6xxdubjxn69m4qruhomhkut&ep=v1_gifs_search&rid=giphy.gif&ct=g"})),(0,i.kt)("p",null,"First, let\u2019s create a buttons component so we don\u2019t have to constantly style a new button. Create a new ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/Button.tsx")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { ButtonHTMLAttributes } from 'react';\n\ninterface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  isLoading?: boolean;\n}\n\nexport default function Button({ isLoading, children, ...otherProps }: ButtonProps) {\n  return (\n    <button\n      {...otherProps}\n      className={`flex flex-row justify-center items-center bg-neutral-100 hover:bg-neutral-200 border border-neutral-300 text-blue-500 font-bold px-3 py-1 text-sm rounded-lg ${isLoading ? ' pointer-events-none opacity-70' : 'cursor-pointer'}`}\n    >\n      {isLoading? 'Loading...' : children}\n    </button>\n  );\n}\n")),(0,i.kt)("p",null,"Now let\u2019s add it to your ",(0,i.kt)("inlineCode",{parentName:"p"},"AddNote.tsx")," component, replacing the original button with this one. The whole file should look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useState } from 'react';\nimport embedIdea from '@wasp/actions/embedIdea';\nimport Button from './Button';\n\nexport default function AddNote() {\n  const [idea, setIdea] = useState('');\n  const [isIdeaEmbedding, setIsIdeaEmbedding] = useState(false);\n\n  const handleEmbedIdea = async (e: any) => {\n    try {\n      setIsIdeaEmbedding(true);\n      if (!idea) {\n        throw new Error('Idea cannot be empty');\n      }\n      const embedIdeaResponse = await embedIdea({\n        idea,\n      });\n\n      console.log('embedIdeaResponse: ', embedIdeaResponse);\n    } catch (error: any) {\n      alert(error.message);\n    } finally {\n      setIdea('');\n      setIsIdeaEmbedding(false);\n    }\n  };\n\n  return (\n    <div className='flex flex-row gap-2 justify-center items-end w-full'>\n      <textarea\n        autoFocus\n        onChange={(e) => setIdea(e.target.value)}\n        value={idea}\n        placeholder='LLMs are great for brainstorming!'\n        className='w-full p-4 h-22 bg-neutral-100 border rounded-lg w-full'\n      />\n      <Button isLoading={isIdeaEmbedding} onClick={handleEmbedIdea}>\n        Save Note\n      </Button>\n    </div>\n  );\n}\n")),(0,i.kt)("p",null,"Noice. "),(0,i.kt)("p",null,"Next, we want our page to perform the following actions:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"create a button that runs our ",(0,i.kt)("inlineCode",{parentName:"li"},"generateNewIdeas")," action when clicked"),(0,i.kt)("li",{parentName:"ol"},"define the query that fetches and caches the tweet drafts and ideas "),(0,i.kt)("li",{parentName:"ol"},"loop through the results and display them on the page")),(0,i.kt)("p",null,"That\u2019s exactly what the below code will do. Go ahead and replace the ",(0,i.kt)("inlineCode",{parentName:"p"},"MainPage")," with it and take a minute to review what\u2019s going on:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import waspLogo from './waspLogo.png';\nimport './Main.css';\nimport { useState } from 'react';\nimport generateNewIdeas from '@wasp/actions/generateNewIdeas';\nimport { useQuery } from '@wasp/queries';\nimport getTweetDraftsWithIdeas from '@wasp/queries/getTweetDraftsWithIdeas';\nimport AddNote from './AddNote';\nimport Button from './Button';\n\nconst MainPage = () => {\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const {\n    data: tweetDrafts,\n    isLoading: isTweetDraftsLoading,\n    error: tweetDraftsError,\n  } = useQuery(getTweetDraftsWithIdeas);\n\n  const handleNewIdeas = async (e: any) => {\n    try {\n      setIsGenerating(true);\n      await generateNewIdeas();\n    } catch (error: any) {\n      alert(error.message);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  if (isTweetDraftsLoading) {\n    return 'Loading...';\n  }\n\n  if (tweetDraftsError) {\n    return 'Error: ' + tweetDraftsError.message;\n  }\n\n  return (\n    <div className='min-h-screen bg-neutral-300/70 text-center'>\n      <div className='flex flex-col gap-6 justify-center items-center mx-auto pt-12'>\n        <img src={waspLogo} className='w-5' />\n        <div className='flex flex-col gap-4 justify-center items-center w-2/4'>\n          <AddNote />\n          <hr className='border border-t-1 border-neutral-100/70 w-full' />\n          <div className='flex flex-row justify-center w-1/4'>\n            <Button onClick={handleNewIdeas} isLoading={isGenerating}>\n              Generate New Ideas\n            </Button>\n          </div>\n          <div className='flex flex-col gap-4 justify-center items-center w-full'>\n            {tweetDrafts.map((tweetDraft) => (\n              <>\n                <h2 className='text-2xl font-bold'>Generated Ideas</h2>\n                <div key={tweetDraft.id} className='flex flex-col gap-2 justify-center items-center w-full'>\n                  <h2>Tweet Draft</h2>\n                  <div className='flex flex-row gap-2 justify-center items-center w-full'>\n                    <div className='w-full p-4 h-22 bg-blue-100 border rounded-lg w-full'>{tweetDraft.content}</div>\n                  </div>\n\n                  {!!tweetDraft.notes && tweetDraft.notes !== tweetDraft.originalTweet.content && (\n                    <>\n                      <h2>Your Similar Notes</h2>\n                      {tweetDraft.notes}\n                    </>\n                  )}\n                  <div className='flex flex-col gap-2 justify-center items-center w-full'>\n                    <h2>Ideas</h2>\n                    {tweetDraft.originalTweet.ideas.map((idea) => (\n                      <div key={idea.id} className='flex flex-row gap-2 justify-center items-center w-full'>\n                        <div className='flex flex-row gap-2 justify-center items-center w-full'>\n                          <div className='w-full p-4 h-22 bg-neutral-100 border rounded-lg w-full'>{idea.content}</div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\nexport default MainPage;\n")),(0,i.kt)("p",null,"This is what you should see on the homepage now! \ud83c\udf89"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(25668).Z,width:"874",height:"261"})),(0,i.kt)("p",null,"But, if you clicked \u2018generate new ideas\u2019 and nothing happened, well that\u2019s because we haven\u2019t defined any favorite trend-setting twitter users to scrape tweets from. And there\u2019s no way to do that from the UI at the moment, so let\u2019s open up the database manager and add some manually."),(0,i.kt)("p",null,"In a new terminal tab, in the root of your project, run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wasp db studio\n")),(0,i.kt)("p",null,"Then, in a new browswer tab, at ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:5555"},"localhost:5555")," you should see your database. "),(0,i.kt)("p",null,"Go to ",(0,i.kt)("inlineCode",{parentName:"p"},"user"),", and you should be the only user in there. Add the usernames of a couple of your favorite trend-setting twitter users. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(62606).Z,width:"2156",height:"808"})),(0,i.kt)("p",null,"Make sure the accounts have tweeted recently or your function won\u2019t be able to scrape or generate anything! "),(0,i.kt)("admonition",{title:"Hey \u270b",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"While you\u2019re at it, if you\u2019re liking this tutorial, give me a ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/hot_town"},"follow @hot_town")," for more future content like this")),(0,i.kt)("p",null,"After adding the twitter usernames, make sure you click ",(0,i.kt)("inlineCode",{parentName:"p"},"save 1 change"),". "),(0,i.kt)("p",null,"Go back to your client and click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Generate New Ideas")," button again. This might take a while depending on how many tweets it\u2019s generating ideas for, so be patient \u2014 and watch the console output in your terminal if you\u2019re curious ;)"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(11429).Z,width:"1732",height:"1542"})),(0,i.kt)("p",null,"Awesome! Now we should be getting back some generated ideas from our twitter \u201cintern\u201d which will help us brainstorm further notes and generate our own BANGER TWEETS."),(0,i.kt)("p",null,"But it would be cool to also display the tweet these ideas are referencing from the beginning. That way we\u2019d have a bit more context on where the ideas came from."),(0,i.kt)("p",null,"Let\u2019s do that then! In your ",(0,i.kt)("inlineCode",{parentName:"p"},"MainPage")," file, at the very top, add the following import:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { TwitterTweetEmbed } from 'react-twitter-embed';\n")),(0,i.kt)("p",null,"This allows us to embed tweets with that nice twitter styling."),(0,i.kt)("p",null,"We already added this dependency to our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file at the beginning of the tutorial, so we can just import and start embedding tweets."),(0,i.kt)("p",null,"Let\u2019s try it out now in our ",(0,i.kt)("inlineCode",{parentName:"p"},"MainPage")," by adding the following snippet above our ",(0,i.kt)("inlineCode",{parentName:"p"},"<h2>Tweet Draft</h2>")," element:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"//...\n\n<h2>Original Tweet</h2>\n<div className='flex flex-row gap-2 justify-center items-center w-full'>\n  <TwitterTweetEmbed tweetId={tweetDraft.originalTweet.tweetId} />\n</div>\n\n<h2>Tweet Draft</h2>\n//...\n")),(0,i.kt)("p",null,"Great. Now we should be sitting pretty \ud83d\ude3b"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(99506).Z,width:"858",height:"856"})),(0,i.kt)("p",null,"You might remember from the beginning of the tutorial when we defined the LLM calls, that if your vector store notes don\u2019t turn back a cosine similarity of at least 0.7, your agent will generate its own ideas entirely without using your notes as a guide. "),(0,i.kt)("p",null,"And since we have NO notes in our vector store at the moment, that\u2019s exactly what it is doing. Which is fine, because we can let it brainstorm for us, and we can select our favorite notes and edit and add them as we see fit."),(0,i.kt)("p",null,"So you can go ahead and start adding notes whenever you feel like it \ud83d\udcdd."),(0,i.kt)("p",null,"But, we\u2019ve added our favorite twitter users to the database manually. It would be preferable to do it via an account settings page, right? Let\u2019s make one then."),(0,i.kt)("h3",{id:"creating-an-account-settings-page"},"Creating an Account Settings Page"),(0,i.kt)("p",null,"First, add the route and page to your ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," config file, under the other routes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'//...\n\nroute AccountRoute { path: "/account", to: AccountPage }\npage AccountPage {\n  authRequired: true,\n  component: import Account from "@client/AccountPage"\n}\n')),(0,i.kt)("p",null,"Next, let\u2019s create a new page, ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/AccountPage.tsx"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import Button from './Button';\nimport { ChangeEvent, useEffect, useState } from 'react';\nimport logout from '@wasp/auth/logout';\nimport type { User } from '@wasp/entities';\n\nconst AccountPage = ({ user }: { user: User }) => {\n  return (\n        <div className='flex flex-col justify-center items-center mt-12 w-full'>\n      <div className='flex flex-col items-center justify-center gap-4 border border-neutral-700 bg-neutral-100/40 rounded-xl p-1 sm:p-4 w-full'>\n        <div className='flex flex-row justify-end w-full px-4 pt-2'>\n          <Button onClick={logout}>Logout</Button>\n        </div>\n        {JSON.stringify(user, null, 2)}\n      </div>\n    </div>\n  );\n};\n\nexport default AccountPage;\n")),(0,i.kt)("p",null,"When you navigate to ",(0,i.kt)("a",{parentName:"p",href:"localhost:3000/account"},"localhost:3000/account"),", you\u2019ll notice two things, one of them being a logout button. You can see in our ",(0,i.kt)("inlineCode",{parentName:"p"},"SettingsPage")," above that we imported a Wasp-provided ",(0,i.kt)("inlineCode",{parentName:"p"},"logout")," function. We get this \u201cfor free\u201d since we defined our ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," strategy in the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file \u2014 a big time-saver!"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(4375).Z,width:"1372",height:"424"})),(0,i.kt)("p",null,"Because we also defined the ",(0,i.kt)("inlineCode",{parentName:"p"},"AccountPage")," route with the ",(0,i.kt)("inlineCode",{parentName:"p"},"authRequired: true")," property, Wasp will automatically pass the logged in user as a prop argument to our page. We can use the user object to display and update our ",(0,i.kt)("inlineCode",{parentName:"p"},"favUsers"),", just as we can see in the image above."),(0,i.kt)("p",null,"To do that, let\u2019s define a new ",(0,i.kt)("inlineCode",{parentName:"p"},"updateAccount")," action in our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'action updateAccount {\n  fn: import { updateAccount } from "@server/account.js",\n  entities: [User]\n}\n')),(0,i.kt)("p",null,"Next, let\u2019s create the ",(0,i.kt)("inlineCode",{parentName:"p"},"updateAccount")," action in a new file, ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/account.ts"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import type { UpdateAccount } from "@wasp/actions/types";\nimport HttpError from "@wasp/core/HttpError.js";\n\nexport const updateAccount: UpdateAccount<{ favUsers: string[] }, void> = async ({ favUsers }, context) => {\n  if (!context.user) {\n    throw new HttpError(401, "User is not authorized");\n  }\n\n  try {\n    await context.entities.User.update({\n      where: { id: context.user.id },\n      data: { favUsers },\n    });\n    \n  } catch (error: any) {\n    throw new HttpError(500, error.message);\n  }\n}\n')),(0,i.kt)("p",null,"Right. Now it\u2019s time to put it all together in our ",(0,i.kt)("inlineCode",{parentName:"p"},"Account")," page. We\u2019re going to create a form for adding new twitter users to scrape tweets from, so at the bottom of your  ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/AccountPage.tsx"),", below your other code, add the following component:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"function InputFields({ user }: { user: User }) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [fields, setFields] = useState(['']);\n\n  useEffect(() => {\n    if (user?.favUsers.length > 0) {\n      setFields(user.favUsers);\n    }\n  }, [user?.favUsers]);\n\n  const handleAdd = () => {\n    setFields([...fields, '']);\n  };\n\n  const handleRemove = () => {\n    const newFields = [...fields];\n    newFields.splice(fields.length - 1, 1);\n    setFields(newFields);\n  };\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>, index: number) => {\n    const newFields = [...fields];\n    newFields[index] = e.target.value;\n    setFields(newFields);\n  };\n\n  const handleSubmit = async () => {\n    //...\n  };\n\n  return (\n    <div className='w-full p-4'>\n      <div className='flex flex-row justify-start items-start'>\n        <h2 className='ml-1 font-bold'>Trend-Setting Twitter Accounts</h2>\n      </div>\n      {fields.map((field, index) => (\n        <div key={index} className='my-2'>\n          <input\n            type='text'\n            placeholder='Twitter Username'\n            className='w-full bg-white border border-gray-300 rounded-lg py-2 px-4 text-gray-700 focus:border-blue-400 focus:outline-none'\n            value={field}\n            onChange={(e) => handleChange(e, index)}\n          />\n        </div>\n      ))}\n      <div className='my-2 flex flex-row justify-end gap-1'>\n        {fields.length > 1 && <Button onClick={handleRemove}>-</Button>}\n        {fields.length < 10 && (\n          <Button onClick={handleAdd} className='bg-blue-500 text-white px-4 py-2 rounded'>\n            +\n          </Button>\n        )}\n      </div>\n      <Button onClick={handleSubmit} isLoading={isLoading}>\n        <span>Save</span>\n      </Button>\n    </div>\n  );\n}\n")),(0,i.kt)("p",null,"This component takes care of adding the logged in user\u2019s ",(0,i.kt)("inlineCode",{parentName:"p"},"favUsers")," array to state, and displaying that in information in a set of input components."),(0,i.kt)("p",null,"The only thing missing from it is to add our ",(0,i.kt)("inlineCode",{parentName:"p"},"updateAccount")," action we just defined earlier. So at the top of the file, let\u2019s import it and add the logic to our ",(0,i.kt)("inlineCode",{parentName:"p"},"InputFields")," submit handler"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import updateAccount from '@wasp/actions/updateAccount'; // <--- add this import\n\n//...\n\nconst handleSubmit = async () => { // < --- add this function\n    try {\n      setIsLoading(true);\n      await updateAccount({ favUsers: fields });\n    } catch (err: any) {\n      alert(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n")),(0,i.kt)("p",null,"Also, in your ",(0,i.kt)("inlineCode",{parentName:"p"},"AccountPage")," make sure to replace the line ",(0,i.kt)("inlineCode",{parentName:"p"},"{JSON.stringify(user, null, 2)}")," with the newly created component ",(0,i.kt)("inlineCode",{parentName:"p"},"<InputFields user={user} />"),". "),(0,i.kt)("p",null,"Here is what the entire ",(0,i.kt)("inlineCode",{parentName:"p"},"AccountPage.tsx")," file should now look like in case you get stuck:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import Button from './Button';\nimport { ChangeEvent, useEffect, useState } from 'react';\nimport logout from '@wasp/auth/logout';\nimport type { User } from '@wasp/entities';\nimport updateAccount from '@wasp/actions/updateAccount'\n\nconst AccountPage = ({ user }: { user: User }) => {\n  return (\n    <div className='flex flex-col justify-center items-center mt-12 w-full'>\n      <div className='flex flex-col items-center justify-center gap-4 border border-neutral-700 bg-neutral-100/40 rounded-xl p-1 sm:p-4 w-full'>\n        <div className='flex flex-row justify-end w-full px-4 pt-2'>\n          <Button onClick={logout}>Logout</Button>\n        </div>\n        <InputFields user={user} />\n      </div>\n    </div>\n  );\n};\n\nexport default AccountPage;\n\nfunction InputFields({ user }: { user: User }) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [fields, setFields] = useState(['']);\n\n  useEffect(() => {\n    if (user?.favUsers.length > 0) {\n      setFields(user.favUsers);\n    }\n  }, [user?.favUsers]);\n\n  const handleAdd = () => {\n    setFields([...fields, '']);\n  };\n\n  const handleRemove = () => {\n    const newFields = [...fields];\n    newFields.splice(fields.length - 1, 1);\n    setFields(newFields);\n  };\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>, index: number) => {\n    const newFields = [...fields];\n    newFields[index] = e.target.value;\n    setFields(newFields);\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setIsLoading(true);\n      await updateAccount({ favUsers: fields });\n    } catch (err: any) {\n      alert(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className='w-full p-4'>\n      <div className='flex flex-row justify-start items-start'>\n        <h2 className='ml-1 font-bold'>Trend-Setting Twitter Accounts</h2>\n      </div>\n      {fields.map((field, index) => (\n        <div key={index} className='my-2'>\n          <input\n            type='text'\n            placeholder='Twitter Username'\n            className='w-full bg-white border border-gray-300 rounded-lg py-2 px-4 text-gray-700 focus:border-blue-400 focus:outline-none'\n            value={field}\n            onChange={(e) => handleChange(e, index)}\n          />\n        </div>\n      ))}\n      <div className='my-2 flex flex-row justify-end gap-1'>\n        {fields.length > 1 && <Button onClick={handleRemove}>-</Button>}\n        {fields.length < 10 && (\n          <Button onClick={handleAdd} className='bg-blue-500 text-white px-4 py-2 rounded'>\n            +\n          </Button>\n        )}\n      </div>\n      <Button onClick={handleSubmit} isLoading={isLoading}>\n        <span>Save</span>\n      </Button>\n    </div>\n  );\n}\n")),(0,i.kt)("p",null,"And here\u2019s what your ",(0,i.kt)("inlineCode",{parentName:"p"},"AccountPage")," should look like when navigating to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000/account"},"localhost:3000/account")," (note: the styling may be a bit ugly, but we\u2019ll take care of that later):"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(61339).Z,width:"1480",height:"968"})),(0,i.kt)("p",null,"Fantastic. So we\u2019ve got the majority of the app logic finished \u2014 our own personal twitter \u201cintern\u201d to help us all become thought leaders and thread bois \ud83e\udd23."),(0,i.kt)("h3",{id:"adding-a-cron-job"},"Adding a Cron Job"),(0,i.kt)("p",null,"But wouldn\u2019t it be cool if we could automate the ",(0,i.kt)("inlineCode",{parentName:"p"},"Generate New Ideas")," process? Each time you click the button, it takes quite a while for tweets to be scraped, and ideas to be generated, especially if we are generating ideas for a lot of new tweets."),(0,i.kt)("p",null,"So it would be nicer if we had a cron job (recurring task), that ran automatically in the background at a set interval."),(0,i.kt)("p",null,"With Wasp, that\u2019s also super easy to set up. To do so, let\u2019s go to our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file and add our job at the very bottom:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'//...\n\njob newIdeasJob {\n  executor: PgBoss,\n  perform: {\n    fn: import generateNewIdeasWorker from "@server/worker/generateNewIdeasWorker.js"\n  },\n  entities: [User, GeneratedIdea, Tweet, TweetDraft],\n  schedule: {\n    // run cron job every 30 minutes\n    cron: "*/30 * * * *",\n    executorOptions: {\n      pgBoss: {=json { "retryLimit": 2 } json=},\n    }\n  }\n}\n')),(0,i.kt)("p",null,"Let\u2019s run through the code above:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Jobs use ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/timgit/pg-boss"},"pg-boss"),", a postgres extension, to queue and run tasks under the hood."),(0,i.kt)("li",{parentName:"ul"},"with ",(0,i.kt)("inlineCode",{parentName:"li"},"perform")," we\u2019re telling the job what function we want it to call: ",(0,i.kt)("inlineCode",{parentName:"li"},"generateNewIdeasWorker")),(0,i.kt)("li",{parentName:"ul"},"just like actions and queries, we have to tell the job which entities we want to give it access to. In this case, we will need access to all of our entities."),(0,i.kt)("li",{parentName:"ul"},"the schedule allows us to pass some options to pg-boss so that we can make it a recurring task. In this case, I set it to run every 30 minutes, but you can set it to any interval you\u2019d like (tip: change the comment and let github co-pilot write the cron for you). We also tell pg-boss to retry a failed job two times.")),(0,i.kt)("p",null,"Perfect. So now, our app will automatically scrape our favorite users\u2019 tweets and generate new ideas for us every 30 minutes. This way, if we revisit the app after a few days, all the content will already be there and we won\u2019t have to wait a long time for it to generate it for us. We also make sure we never miss out on generating ideas for older tweets."),(0,i.kt)("p",null,"But for that to happen, we have to define the function our job will call. To do this, create a new directory ",(0,i.kt)("inlineCode",{parentName:"p"},"worker")," within the ",(0,i.kt)("inlineCode",{parentName:"p"},"server")," folder, and within it a new file: ",(0,i.kt)("inlineCode",{parentName:"p"},"src/server/worker/generateNewIdeasWorker")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { generateNewIdeas } from '../ideas.js';\n\nexport default async function generateNewIdeasWorker(_args: unknown, context: any) {\n  try {\n    console.log('Running recurring task: generateNewIdeasWorker')\n    const allUsers = await context.entities.User.findMany({});\n\n    for (const user of allUsers) {\n      context.user = user;\n      console.log('Generating new ideas for user: ', user.username);\n      await generateNewIdeas(undefined as never, context);\n      console.log('Done generating new ideas for user: ', user.username)\n    }\n\n  } catch (error: any) {\n    console.log('Recurring task error: ', error);\n  }\n}\n")),(0,i.kt)("p",null,"In this file, all we\u2019re doing is looping through all the users in our database, and passing them via the context object to our ",(0,i.kt)("inlineCode",{parentName:"p"},"generateNewIdeas")," action. The nice thing about jobs is that Wasp automatically passes the ",(0,i.kt)("inlineCode",{parentName:"p"},"context")," object to these functions, which we can then pass along to our action."),(0,i.kt)("p",null,"So now, at the interval that you set (e.g. 30 minutes), you should notice the logs being printed to the console whenever your job starts automatically running."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"[Server]  Generating new ideas for user:  vinny\n")),(0,i.kt)("p",null,"Alright, things are looking pretty good now, but let\u2019s not forget to add a page to view all the notes we added and embedded to our vector store!"),(0,i.kt)("h3",{id:"adding-a-notes-page"},"Adding a Notes Page"),(0,i.kt)("p",null,"Go ahead and add the following route to your ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'route NotesPage { path: "/notes", to: NotesPage }\npage NotesPage {\n  authRequired: true,\n  component: import Notes from "@client/NotesPage"\n}\n')),(0,i.kt)("p",null,"Create the complementary page, ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/NotesPage.tsx")," and add the following boilerplate just to get started (we\u2019ll add the rest later):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"const NotesPage = () => {\n\n  return (\n    <>Notes</>\n  );\n};\n\nexport default NotesPage;\n")),(0,i.kt)("p",null,"It would be nice if we had a simple Nav Bar to navigate back and forth between our two pages. It would also be cool if we had our ",(0,i.kt)("inlineCode",{parentName:"p"},"<AddNote />")," input component on all pages, that way it\u2019s easy for us to add an idea whenever inspiration strikes."),(0,i.kt)("p",null,"Rather than copying the NavBar and AddNote code to both pages, let\u2019s create a wrapper, or \u201croot\u201d, component for our entire app so that all of our pages have the same Nav Bar and layout. "),(0,i.kt)("p",null,"To do that, in our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file, let\u2019s define our root component by adding a ",(0,i.kt)("inlineCode",{parentName:"p"},"client")," property to our ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," configuration at the very top of the file. This is how the entire ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," object should look like now:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"lines={6-8}",lines:"{6-8}"},'app twitterAgent {\n  wasp: {\n    version: "^0.10.6"\n  },\n  title: "twitter-agent",\n  client: { \n    rootComponent: import App from "@client/App",\n  },\n  db: { \n    system: PostgreSQL,\n  },\n  auth: {\n    userEntity: User,\n    onAuthFailedRedirectTo: "/login",\n    methods: {\n      usernameAndPassword: {},\n    }\n  },\n  dependencies: [\n    ("openai", "3.2.1"),\n    ("rettiwt-api", "1.1.8"),\n    ("langchain", "0.0.91"),\n    ("@pinecone-database/pinecone", "0.1.6"),\n    ("@headlessui/react", "1.7.15"),\n    ("react-icons", "4.8.0"),\n    ("react-twitter-embed", "4.0.4")\n  ],\n}\n\n// entities, operations, routes, and other stuff...\n')),(0,i.kt)("p",null,"Next, create a new file ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/App.tsx")," with the following content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import './Main.css';\nimport AddNote from './AddNote';\nimport { ReactNode } from 'react';\nimport useAuth from '@wasp/auth/useAuth';\n\nconst App = ({ children }: { children: ReactNode }) => {\n\n  const { data: user } = useAuth();\n\n  return (\n    <div className='min-h-screen bg-neutral-300/70 text-center'>\n      <div className='flex flex-col gap-6 justify-center items-center mx-auto pt-12'>\n        <div className='flex flex-row justify-between items-center w-1/2 mb-6 text-neutral-600 px-2'>\n          <div className='flex justify-start w-1/3'>\n            <a href='/' className='hover:underline cursor-pointer'>\n              \ud83e\udd16 Generated Ideas\n            </a>\n          </div>\n          <div className='flex justify-center w-1/3'>\n            <a href='/notes' className='hover:underline cursor-pointer'>\n              \ud83d\udcdd My Notes\n            </a>\n          </div>\n          <div className='flex justify-end w-1/3'>\n            <a href='/account' className='hover:underline cursor-pointer'>\n              \ud83d\udc64 Account\n            </a>\n          </div>\n        </div>\n\n        <div className='flex flex-col gap-4 justify-center items-center w-2/4'>\n          {!!user && <AddNote />}\n          <hr className='border border-t-1 border-neutral-100/70 w-full' />\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default App;\n")),(0,i.kt)("p",null,"With this defined, Wasp will know to pass all other routes as ",(0,i.kt)("inlineCode",{parentName:"p"},"children")," through our ",(0,i.kt)("inlineCode",{parentName:"p"},"App")," component. That way, we will always show the Nav Bar and ",(0,i.kt)("inlineCode",{parentName:"p"},"AddNote")," component on the top of every page."),(0,i.kt)("p",null,"We also take advantage of Wasp\u2019s handy ",(0,i.kt)("inlineCode",{parentName:"p"},"useAuth")," hook to check if a user is logged in, and if so we show the ",(0,i.kt)("inlineCode",{parentName:"p"},"AddNote")," component."),(0,i.kt)("p",null,"Now, we can delete the duplicate code on our ",(0,i.kt)("inlineCode",{parentName:"p"},"MainPage"),". This is what it should look like now:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useState } from 'react';\nimport generateNewIdeas from '@wasp/actions/generateNewIdeas';\nimport { useQuery } from '@wasp/queries';\nimport getTweetDraftsWithIdeas from '@wasp/queries/getTweetDraftsWithIdeas';\nimport Button from './Button';\nimport { TwitterTweetEmbed } from 'react-twitter-embed';\n\nconst MainPage = () => {\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const {\n    data: tweetDrafts,\n    isLoading: isTweetDraftsLoading,\n    error: tweetDraftsError,\n  } = useQuery(getTweetDraftsWithIdeas);\n\n  const handleNewIdeas = async (e: any) => {\n    try {\n      setIsGenerating(true);\n      await generateNewIdeas();\n    } catch (error: any) {\n      alert(error.message);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  if (isTweetDraftsLoading) {\n    return 'Loading...';\n  }\n\n  if (tweetDraftsError) {\n    return 'Error: ' + tweetDraftsError.message;\n  }\n\n  return (\n    <>\n      <div className='flex flex-row justify-center w-full'>\n        <Button onClick={handleNewIdeas} isLoading={isGenerating}>\n          Generate New Ideas\n        </Button>\n      </div>\n      <div className='flex flex-col gap-4 justify-center items-center w-full'>\n        {tweetDrafts.map((tweetDraft) => (\n          <>\n            <h2 className='text-2xl font-bold'>Generated Ideas</h2>\n            <div key={tweetDraft.id} className='flex flex-col gap-2 justify-center items-center w-full'>\n              <h2>Original Tweet</h2>\n              <div className='flex flex-row gap-2 justify-center items-center w-full'>\n                <TwitterTweetEmbed tweetId={tweetDraft.originalTweet.tweetId} />\n              </div>\n              <h2>Tweet Draft</h2>\n              <div className='flex flex-row gap-2 justify-center items-center w-full'>\n                <div className='w-full p-4 h-22 bg-blue-100 border rounded-lg w-full'>{tweetDraft.content}</div>\n              </div>\n\n              {!!tweetDraft.notes && tweetDraft.notes !== tweetDraft.originalTweet.content && (\n                <>\n                  <h2>Your Similar Notes</h2>\n                  {tweetDraft.notes}\n                </>\n              )}\n              <div className='flex flex-col gap-2 justify-center items-center w-full'>\n                <h2>Ideas</h2>\n                {tweetDraft.originalTweet.ideas.map((idea) => (\n                  <div key={idea.id} className='flex flex-row gap-2 justify-center items-center w-full'>\n                    <div className='flex flex-row gap-2 justify-center items-center w-full'>\n                      <div className='w-full p-4 h-22 bg-neutral-100 border rounded-lg w-full'>{idea.content}</div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </>\n        ))}\n      </div>\n    </>\n  );\n};\nexport default MainPage;\n")),(0,i.kt)("p",null,"Next, we need to create a query that allows us to fetch all of our added notes and ideas that have been embedded in our vector store."),(0,i.kt)("p",null,"For that, we need to define a new ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," in our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.wasp")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'query getEmbeddedNotes {\n  fn: import { getEmbeddedNotes } from "@server/ideas.js",\n  entities: [GeneratedIdea]\n}\n')),(0,i.kt)("p",null,"We then need to create that ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," at the bottom of our ",(0,i.kt)("inlineCode",{parentName:"p"},"src/actions/ideas.ts")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"// first import the type at the top of the file\nimport type { GetEmbeddedNotes, GetTweetDraftsWithIdeas } from '@wasp/queries/types';\n\n//...\n\nexport const getEmbeddedNotes: GetEmbeddedNotes<never, GeneratedIdea[]> = async (_args, context) => {\n  if (!context.user) {\n    throw new HttpError(401, 'User is not authorized');\n  }\n\n  const notes = await context.entities.GeneratedIdea.findMany({\n    where: {\n      userId: context.user.id,\n      isEmbedded: true,\n    },\n        orderBy: {\n      createdAt: 'desc',\n    },\n  });\n\n  return notes;\n}\n")),(0,i.kt)("p",null,"Now let\u2019s go back to our ",(0,i.kt)("inlineCode",{parentName:"p"},"src/client/NotesPage.tsx")," and add our query. Our new file will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useQuery } from '@wasp/queries';\nimport getEmbeddedNotes from '@wasp/queries/getEmbeddedNotes';\n\nconst NotesPage = () => {\n  const { data: notes, isLoading, error } = useQuery(getEmbeddedNotes);\n\n  if (isLoading) <div>Loading...</div>;\n  if (error) <div>Error: {error.message}</div>;\n\n  return (\n    <>\n      <h2 className='text-2xl font-bold'>My Notes</h2>\n      {notes && notes.length > 0 ? (\n        notes.map((note) => (\n          <div key={note.id} className='flex flex-col gap-2 justify-center items-center w-full'>\n            <div className='flex flex-row gap-2 justify-center items-center w-full'>\n              <div className='w-full p-4 h-22 bg-blue-100 border rounded-lg w-full'>{note.content}</div>\n            </div>\n          </div>\n        ))\n      ) : notes && notes.length === 0 && (\n        <div className='flex flex-col gap-2 justify-center items-center w-full'>\n          <div className='w-full p-4 h-22 bg-blue-100 border rounded-lg w-full'>No notes yet</div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default NotesPage;\n")),(0,i.kt)("p",null,"Cool! Now we should be fetching all our embedded notes and ideas, signified by the ",(0,i.kt)("inlineCode",{parentName:"p"},"isEmbedded")," tag in our postgres database. Your Notes page should now look something like this:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Untitled",src:n(6341).Z,width:"1574",height:"850"})),(0,i.kt)("h2",{id:"you-did-it-your-own-twitter-intern-"},"You Did it! Your own Twitter Intern \ud83e\udd16"),(0,i.kt)("admonition",{title:"Help me help you",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"\ud83c\udf1f ",(0,i.kt)("strong",{parentName:"p"},"If you haven\u2019t yet, please")," ",(0,i.kt)("a",{parentName:"p",href:"https://www.github.com/wasp-lang/wasp"},"star us on GitHub"),", especially if you found this useful! If you do, it helps support us in creating more content like this. And if you don\u2019t\u2026 well, we will deal with it, I guess."),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{parentName:"p",src:"https://media.giphy.com/media/3oEjHEmvj6yScz914s/giphy.gif",alt:"https://media.giphy.com/media/3oEjHEmvj6yScz914s/giphy.gif"}))),(0,i.kt)("p",null,"And that\u2019s it! You\u2019ve now got yourself a semi-autonomous twitter brainstorming agent to help inspire new ideas and keep you actively contributing \ud83d\ude80"),(0,i.kt)("p",null,"There\u2019s way more you can do with these tools, but this is a great start."),(0,i.kt)("p",null,"Remember, if you want to see a more advanced version of this app which utilizes the official Twitter API to send tweets, gives you the ability to edit and add generated notes on the fly, has manual similarity search for all your notes, and more, then you can check out the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vincanger/banger-tweet-bot"},"\ud83d\udca5 Banger Tweet Bot \ud83e\udd16"),". "),(0,i.kt)("p",null,"And, once again, here's the repo for the finished app we built in this tutorial: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/vincanger/twitter-intern"},"Personal Twitter Intern")))}c.isMDXComponent=!0},70589:(e,t,n)=>{n.d(t,{ZP:()=>s});var a=n(87462),i=(n(67294),n(3905));const o={toc:[]},r="wrapper";function s(e){let{components:t,...n}=e;return(0,i.kt)(r,(0,a.Z)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Wasp is a configuration language (DSL) for building full-stack web apps with less code and best practices that works alongside React and Node.js. We are on a mission to streamline web app development while empowering developers to continue using the power of code and their favorite tools. We are backed by Y Combinator and engineers from Airbnb, Facebook, and Lyft.")))}s.isMDXComponent=!0},34879:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 1-e3254b5d1e1395b581a21df686da0443.png"},61339:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 10-e48345be95876555b887ecc592546439.png"},6341:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 11-bc8380cd12a7d5c94ea7b4c2b04189d1.png"},88241:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 2-f24513d45ffb01fbda70fc38bbeba4ab.png"},93471:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 3-47d42bc18be95b8cd9f575ca5604d110.png"},28613:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 4-9f19346827f50d150f081611a072a33b.png"},25668:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 5-8bb709c37bd4060da4f30334e66e4499.png"},62606:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 6-944845c5dcb71fbb854eb53348eed26f.png"},11429:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 7-3177ae04d6b5b68fbb03a021b3b3594b.png"},99506:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 8-154a93e95f98a02b616da248072a28b8.png"},4375:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled 9-df7d5162a2c5d073932681e127fc1eea.png"},86132:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Untitled-a92a523b6dcedd69c52a2a565f63d3d7.png"},6307:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/twitter-agent-add-note-31c1c2840f9cd514c2fe9748e49f4abb.png"}}]);